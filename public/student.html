<!DOCTYPE html>
<html lang="th">
    <script>
    // --- Security Check ---
const token = localStorage.getItem('adminToken');
if (!token) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
    window.location.href = 'login.html';
}

function logout() {
    localStorage.removeItem('adminToken');
    window.location.href = 'login.html';
}
// ----------------------
</script>

<head>
    <meta charset="UTF-8">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<<body>
    <div class="sidebar">
        <div class="brand">‚öΩ EquipmentHub</div>
        <div class="menu">
            <a href="index.html">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</a>
            <a href="student.html"class="active">üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</a>
            <a href="borrow.html">üìù ‡∏¢‡∏∑‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
            <a href="return.html">‚Ü©Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</a>
            <a href="equipment.html">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å</a>
            <a href="history.html" >üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
            <a href="fines.html">üí∞ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö</a>
            <a href="contact.html">üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
        </div>
        <button onclick="logout()" class="logout-btn-fixed">
    üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
</button>
    </div>

    <div class="content">
        <h1>üë§ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h1>

        <div class="card">
            <h3>+ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="addStudentForm">
                <div class="form-grid">
                    <div><label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label><input type="text" id="sid" required placeholder="6xxxxxx"></div>
                    <div><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="text" id="phone"></div>
                    <div><label>‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á</label><input type="text" id="fname" required></div>
                    <div><label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="lname" required></div>
                    <div><label>‡∏Ñ‡∏ì‡∏∞</label><input type="text" id="fac"></div>
                    <div><label>‡∏™‡∏≤‡∏Ç‡∏≤ (Major)</label><input type="text" id="maj"></div>
                </div>
                <button type="submit" style="margin-top: 15px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </form>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
                <input type="text" id="searchBox" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™..." style="width:250px; margin:0;">
            </div>
            
            <table>
                <thead><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏Ñ‡∏ì‡∏∞ / ‡∏™‡∏≤‡∏Ç‡∏≤</th><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th></tr></thead>
                <tbody id="sList"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/api';

        function loadS() {
            fetch(`${API_URL}/students`)
                .then(r => r.json())
                .then(data => {
                    const tbody = document.getElementById('sList');
                    tbody.innerHTML = data.map(s => `
                        <tr>
                            <td><b>${s.StudentID}</b></td>
                            <td>${s.FirstName} ${s.LastName}</td>
                            <td>${s.Faculty} <span style="color:gray">(${s.Major || '-'})</span></td>
                            <td>${s.Phone || '-'}</td>
                        </tr>`).join('');
                });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (Search Logic)
        document.getElementById('searchBox').addEventListener('keyup', function() {
            let value = this.value.toLowerCase();
            let rows = document.querySelectorAll('#sList tr');
            rows.forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(value) ? '' : 'none';
            });
        });

        document.getElementById('addStudentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const payload = {
                StudentID: document.getElementById('sid').value,
                FirstName: document.getElementById('fname').value,
                LastName: document.getElementById('lname').value,
                Faculty: document.getElementById('fac').value,
                Major: document.getElementById('maj').value,
                Phone: document.getElementById('phone').value
            };

            try {
                const res = await fetch(`${API_URL}/students`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload)
                });
                const result = await res.json();

                if(res.ok) {
                    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏ß‡∏¢
                    Swal.fire({ icon: 'success', title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: result.message, timer: 1500, showConfirmButton: false });
                    document.getElementById('addStudentForm').reset();
                    loadS();
                } else {
                    Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: result.message });
                }
            } catch (err) {
                Swal.fire({ icon: 'error', title: 'Server Error', text: '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' });
            }
        });

        loadS();
    </script>
</body>
</html>