<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="sidebar">
        <div class="brand">‚öΩ EquipmentHub</div>
        <div class="menu">
            <a href="index.html">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</a>
            <a href="student.html">üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</a>
            <a href="borrow.html">üìù ‡∏¢‡∏∑‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
            <a href="return.html">‚Ü©Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</a>
            <a href="equipment.html">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å</a>
            <a href="history.html" class="active">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
            <a href="fines.html">üí∞ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö</a>
            <a href="contact.html">üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
        </div>
        <button onclick="logout()" style="position: absolute; bottom: 20px; width: 80%; margin: 0 auto; background-color: #f87171; color: white;">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div class="content">
        <h1>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <input type="text" id="searchBox" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ID/‡∏ä‡∏∑‡πà‡∏≠/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå..." style="width:300px; margin:0;">
            </div>
            <table>
                <thead>
                    <tr>
                        <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</th>
                        <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                        <th>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                        <th>‡∏¢‡∏∑‡∏°/‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</th>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô</th>
                        <th>‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    </tr>
                </thead>
                <tbody id="historyList"></tbody>
            </table>
        </div>
    </div>

    <script>
        // --- Security Check ---
        const token = localStorage.getItem('adminToken');
        if (!token) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
            window.location.href = 'login.html';
        }
        function logout() {
            localStorage.removeItem('adminToken');
            window.location.href = 'login.html';
        }
        // ----------------------
        
        const API_URL = 'http://localhost:3001/api';

        function loadHistory() {
            fetch(`${API_URL}/history`)
                .then(r => r.json())
                .then(data => {
                    const tbody = document.getElementById('historyList');
                    tbody.innerHTML = data.map(r => {
                        const isReturned = r.Status === 'Returned';
                        const statusColor = isReturned ? '#10b981' : '#f59e0b'; // Green/Orange
                        
                        return `
                        <tr>
                            <td>#${r.BorrowID}</td>
                            <td>${r.StudentID}</td>
                            <td>${r.EquipName} (x${r.Qty})</td>
                            <td>${r.BorrowDate.split('T')[0]} / ${r.DueDate.split('T')[0]}</td>
                            <td>${r.ReturnDate ? r.ReturnDate.split('T')[0] : '-'}</td>
                            <td style="color:${r.FineAmount > 0 ? 'red' : 'inherit'};">${r.FineAmount || 0}</td>
                            <td style="color:${statusColor}">${r.Status}</td>
                        </tr>`;
                    }).join('');
                });
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        document.getElementById('searchBox').addEventListener('keyup', function() {
            let value = this.value.toLowerCase();
            let rows = document.querySelectorAll('#historyList tr');
            rows.forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(value) ? '' : 'none';
            });
        });

        loadHistory();
    </script>
</body>
</html>